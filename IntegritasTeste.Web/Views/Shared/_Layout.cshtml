<!doctype html>
<html ng-app="app">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="content-language" content="pt-br" />
    <title>AngularJS: Single Page com ngView e ngRoute</title>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
</head>

<body>
    <ul class="nav nav-tabs">
        @*<li ng-class="{active: activetab == '/'}"><a href="/#/Home">Home</a></li>
            <li ng-class="{active: activetab == '/Store'}"><a href="/#/Store">Store</a></li>*@
        <li ng-class="{active: activetab == '/Products'}"><a href="/Products">Products</a></li>
        <li ng-class="{active: activetab == '/ShoppingCart'}"><a href="/ShoppingCart">ShoppingCart</a></li>
    </ul>

    <div ng-view>
        @RenderBody()
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.8/angular.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-route.min.js"></script>

    <script type="text/javascript">
        var app = angular.module('app', ['ngRoute']);

        app.config(function ($routeProvider, $locationProvider) {
            // remove o # da url
            $locationProvider.html5Mode(true);

            $routeProvider
            //.when('/', {
            //    templateUrl: '/Home',
            //    controller: 'HomeController',
            // })
            //.when('/Store', {
            //    templateUrl: '/Store',
            //    controller: 'StoreController',
            //})
            .when('/Products', {
                templateUrl: '/Store/Products',
                controller: 'ProductsController',
            })
            .when('/ShoppingCart', {
                templateUrl: '/Store/ShoppingCart',
                controller: 'ShoppingCartController',
            })

            // caso não seja nenhum desses, redirecione para a rota '/'
            .otherwise({ redirectTo: '/Products' });
        });


        app.controller('HomeController', function ($rootScope, $location, $http) {
            $rootScope.activetab = $location.path();
        });

        app.controller('StoreController', function ($rootScope, $location, $http) {
            $rootScope.activetab = $location.path();
        });
        app.controller('ShoppingCartController', function ($rootScope, $location, $http) {
            $rootScope.activetab = $location.path();

            $rootScope.GetCurrentPrice = function (Prices) {

                for (var i = 0; i < Prices.length; i++) {
                    return Prices[i].Value;
                }
                return 0;

            };

            $rootScope.TotalCart = function () {
                var total = 0;

                products = $rootScope.cart.products;
                for (var i = 0; i < products.length; i++) {
                    total += $rootScope.GetCurrentPrice(products[i].Prices) * products[i].Quantity;
                }
                return total;
            }

            $http.get('/Cart/Get').then(function (cart) {
                $rootScope.cart = cart.data;
            }, function (error) {
                //  ngDialog.close();
            });

        });
        app.controller('ProductsController', function ($rootScope, $location, $http) {
            $rootScope.activetab = $location.path();
            //$rootScope.message = 'Everyone come and see how good I look!';

            $rootScope.AddCart = function (productId) {
                //alert(productId);

                var product = $rootScope.produtos[productId];

                $http.post("/Cart/Add", product).then(function (response) {

                   if (response.data.success) {
                       //ngDialog.close();
                       //$state.go('app.listarPedido');
                   } else {
                       //ngDialog.close();
                       alert('Erro no sitema');
                       //    $state.go('app.listarPedido');
                   }
                },
                function () {
                    vm.authMsg = 'Server Request Error';
                });
            };

            
          /*  $rootScope.categories = [
       { id: 0, name: "Select a category..."},
       { id: 1, name: "Cars", group : "- Vehicles -" },
       { id: 2, name: "Commercial vehicles", group : "- Vehicles -" },
       { id: 3, name: "Motorcycles", group : "- Vehicles -" }
            ];*/


            $rootScope.change = function () {
                
            };

            $http.get('/Api/Product').then(function (produtos) {
                $rootScope.produtos = produtos.data;
            }, function (error) {
                //  ngDialog.close();
            });


            $http.get('/Api/Category').then(function (categories) {
                $rootScope.categories = categories.data;
            }, function (error) {
                //  ngDialog.close();
            });

           






            console.log($rootScope.produtos);

        });


    </script>

</body>
</html>



@*@Scripts.Render("~/bundles/baseScripts")


    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")

    @RenderSection("scripts", required: false)*@

